스웨거는 api를 문서화 시키는 라이브러리다.

# Quick Usage

Must use swagger annotation (`@ApiModelProperty`) to set custom annotation filed’s swagger doc.

```terminal
$ swagger2markup convert -i ${source.json or url} -f {result}
$ asciidoc -b docbook {result}.adoc   
$ pandoc -f docbook -t markdown_strict {result}.xml -o {result}.md
```

위의 명령어를 통해 Swagger json 혹은 url을 Asciidoc 파일로 변환하고 변환된 Asciidoc 파일을 DocBook으로, 그리고 다시 Markdown 파일로 변환합니다.

> Asciidoc's no output from filter WARNING message issue  
`asciidoc -b` 명령어를 통해 문서를 변환할 때 'no output from filter WARNIG message' 라는 메세지가 출력이 될 수 있는데 이는 known issue로 무시하고 진행해도 됩니다.  
관련 링크 : http://discuss.asciidoctor.org/Improved-errors-reporting-td356.html  

# Swagger API Document

Swagger 라이브러리에 정의된 `Swagger2Controller`를 보면 document를 반환하는 GET api가 정의되어 있다. 정의된 api는 path가 "/v2/api-docs"로 정의 되어 있으며 json 값을 반환한다.

# Swagger Annotation

|Name | Description |
| -        | -      |
| `@Api` | Marks a class as a Swagger resource. |
| `@ApiImplicitParam` | Represents a single parameter in an API Operation. |
| `@ApiImplicitParams` | A wrapper to allow a list of multiple ApiImplicitParam objects.
| `@ApiModel` | Provides additional information about Swagger models. |
| `@ApiModelProperty` | Adds and manipulates data of a model property. |
| `@ApiOperation` | Describes an operation or typically a HTTP method against a specific path. |
| `@ApiParam` | Adds additional meta-data for operation parameters. |
| `@ApiResponse` | Describes a possible response of an operation. |
| `@ApiResponses` | A wrapper to allow a list of multiple ApiResponse objects. |
| `@Authorization` | Declares an authorization scheme to be used on a resource or an operation. |
| `@AuthorizationScope` | Describes an OAuth2 authorization scope. |

더 자세한 설명은 [Swagger Annotation Wiki](https://github.com/swagger-api/swagger-core/wiki/annotations)를 참고.

# Operation Process
`DocumentPluginBootstrapper.start() > scanDocumentation()` >   `ApiDocumentationScanner.scan()` >  
`ApiListeningScanner.scan()` >  
`ApiModelReader.read() > populateDependencies()` >   
`DefaultModelProvider.dependencies() > modelFor() > properties()` >  
`OptimizedModelPropertiesProvider.propertiesFor() > candidateProperties() > propertyFromField() > fieldModelProperty()` > `SchemePluginManager.property()` > `ModelPropertyBuildePlugin.apply()`

`DocumentPluginBootstrapper.start() > scanDocumentation()` >   `ApiDocumentationScanner.scan()` >  
`ApiListeningScanner.scan()` >  
`ApiModelReader.read()` >  
`DefaultModelProvider.modelFor > modelBuilder()` >  
`SchemePluginManager.model()` >  
`ModelBuilderPlugin.apply()`

# Custom Annotation

Swagger에서 제공하는 Annotation 뿐만 아니라 직접생성한 Custom Annotation에 대해서도 api document에 설명을 추가하도록 할 수 있다.

Model과 Model Property에 대한 정보가 api document로 작성될 때, 각각 `ModelBuilderPlugin`와 `ModelPropertyBuilderPlugin`를 거친다.

앞서 살펴본 `@ApiModel`과 `@ApiModelProperty`는 위의 플러그인 클래스를 거쳐 document가 작성된다.

각 플러그인 클래스에서 `apply()` 메서드를 통해 도큐먼트를 작성하는데, 이때 파라메터로 Model 혹은 Property의 컨텍스트 정보를 전달받아 어노테이션을 추출하여 document를 작성한다.

## Model

Model의 경우 

```java
@Component
@Order(SwaggerPluginSupport.SWAGGER_PLUGIN_ORDER)
public class ApiModelBuilder implements ModelBuilderPlugin {
    private final TypeResolver typeResolver;

    @Autowired
    public ApiModelBuilder(TypeResolver typeResolver) {
        this.typeResolver = typeResolver;
    }


    @Override
    public void apply(ModelContext context) {
        ApiModel annotation = AnnotationUtils.findAnnotation(forClass(context), ApiModel.class);
        if (annotation != null) {
            context.getBuilder().description(annotation.description());
        }
    }

    private Class<?> forClass(ModelContext context) {
        return typeResolver.resolve(context.getType()).getErasedType();
    }


    @Override
    public boolean supports(DocumentationType delimiter) {
        return pluginDoesApply(delimiter);
    }
}
```

## Model Property
```java
@Component
@Order(SwaggerPluginSupport.SWAGGER_PLUGIN_ORDER)
public class ApiModelPropertyPropertyBuilder implements ModelPropertyBuilderPlugin {
    @Override
    public void apply(ModelPropertyContext context) {
        Optional<ApiModelProperty> annotation = Optional.absent();

        if (context.getAnnotatedElement().isPresent()) {
            annotation = annotation.or(findApiModePropertyAnnotation(context.getAnnotatedElement().get()));
        }
        if (context.getBeanPropertyDefinition().isPresent()) {
            annotation = annotation.or(findPropertyAnnotation(
                context.getBeanPropertyDefinition().get(), ApiModelProperty.class));
        }
        if (annotation.isPresent()) {
            context.getBuilder()
                .allowableValues(annotation.transform(toAllowableValues()).orNull())
                .required(annotation.transform(toIsRequired()).or(false))
                .readOnly(annotation.transform(toIsReadOnly()).or(false))
                .description(annotation.transform(toDescription()).orNull())
                .isHidden(annotation.transform(toHidden()).or(false))
                .type(annotation.transform(toType(context.getResolver())).orNull())
                .position(annotation.transform(toPosition()).or(0))
                .example(annotation.transform(toExample()).orNull());
        }
    }

    @Override
    public boolean supports(DocumentationType delimiter) {
        return SwaggerPluginSupport.pluginDoesApply(delimiter);
    }
}
```


references  
swagger : https://swagger.io/  
swagger2markup : http://swagger2markup.github.io/swagger2markup/1.3.3/#_swagger2markup_api  
swgager2markup cli : https://github.com/Swagger2Markup/swagger2markup-cli  
asciidoc : https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/  
pandoc : https://pandoc.org/MANUAL.html  